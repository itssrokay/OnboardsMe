import{ja as A,k as z,n as g,w as l}from"./chunk-PYF3QQPI.js";var h=class c{http=g(A);quizzes=l([]);attempts=l([]);loading=l(!1);ATTEMPTS_KEY="onboardsMe_quiz_attempts";constructor(){this.loadQuizzes(),this.loadAttempts()}loadQuizzes(){this.loading.set(!0),this.http.get("/assets/config/quizzes.config.json").subscribe({next:t=>{this.quizzes.set(t.quizzes),this.loading.set(!1)},error:t=>{console.error("Failed to load quizzes:",t),this.loading.set(!1)}})}loadAttempts(){let t=localStorage.getItem(this.ATTEMPTS_KEY);if(t)try{let e=JSON.parse(t);this.attempts.set(e)}catch(e){console.error("Failed to parse quiz attempts:",e)}}saveAttempts(){localStorage.setItem(this.ATTEMPTS_KEY,JSON.stringify(this.attempts()))}getQuizByCourseId(t){return this.quizzes().find(e=>e.courseId===t)||null}getQuizById(t){return this.quizzes().find(e=>e.id===t)||null}hasAttemptedQuiz(t){return this.attempts().some(e=>e.quizId===t)}getLatestAttempt(t){return this.attempts().filter(s=>s.quizId===t).sort((s,r)=>new Date(r.startedAt).getTime()-new Date(s.startedAt).getTime())[0]||null}getAllAttempts(t){return this.attempts().filter(e=>e.quizId===t).sort((e,s)=>new Date(s.startedAt).getTime()-new Date(e.startedAt).getTime())}getPassedQuizIds(){return this.attempts().filter(t=>t.passed&&t.completedAt).map(t=>t.quizId)}hasPassedQuiz(t){return this.attempts().some(e=>e.quizId===t&&e.passed)}startQuizAttempt(t,e){return{quizId:t,courseId:e,startedAt:new Date().toISOString(),answers:{},score:0,passed:!1}}submitQuizAttempt(t,e){let s=this.getQuizById(t.quizId);if(!s)throw new Error("Quiz not found");let r=this.calculateQuizScore(s,e);if(t.completedAt=new Date().toISOString(),t.answers=e,t.score=r.score,t.passed=r.passed,t.startedAt){let o=(new Date().getTime()-new Date(t.startedAt).getTime())/1e3;t.timeTaken=Math.round(o)}let n=[...this.attempts(),t];return this.attempts.set(n),this.saveAttempts(),r}calculateQuizScore(t,e){let s=[],r=0,n=0;t.questions.forEach(i=>{let a=e[i.id],u=i.correctAnswer,w=typeof a=="string"?a.toLowerCase():a,I=typeof u=="string"?u.toLowerCase():u,d=w===I,m=d?i.points:0;r+=i.points,n+=m,s.push({questionId:i.id,question:i.question,userAnswer:a,correctAnswer:u,isCorrect:d,points:i.points,earnedPoints:m,explanation:i.explanation})});let o=r>0?Math.round(n/r*100):0,p=s.filter(i=>i.isCorrect).length,Q=s.length-p,f=o>=t.passingScore;return{totalQuestions:t.questions.length,correctAnswers:p,wrongAnswers:Q,score:o,passed:f,passingScore:t.passingScore,questionResults:s}}resetQuizAttempts(t){let e=this.attempts().filter(s=>s.quizId!==t);this.attempts.set(e),this.saveAttempts()}static \u0275fac=function(e){return new(e||c)};static \u0275prov=z({token:c,factory:c.\u0275fac,providedIn:"root"})};export{h as a};
