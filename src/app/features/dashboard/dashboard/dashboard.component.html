<div class="dashboard-container">
  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading your progress...</p>
    </div>
  } @else {
    <!-- Dashboard Header -->
    <div class="dashboard-header">
      <div class="header-text">
        <h1>
          @if (userName()) {
            Welcome back, {{ userName() }}!
          } @else {
            Your Learning Dashboard
          }
        </h1>
        <p class="subtitle">Track your progress and continue your learning journey</p>
        @if (userRole()) {
          <p class="role-badge">{{ userRole() }}</p>
        }
      </div>
    </div>

    <!-- Stats Section -->
    <app-dashboard-stats
      [overallCompletion]="overallCompletion()"
      [totalCourses]="userCourses().length"
      [inProgressCount]="inProgressCourses().length"
      [completedCount]="completedCourses().length"
      [quizzesPassed]="totalQuizzesPassed()"
      [quizzesFailed]="totalQuizzesFailed()"
      [averageQuizScore]="averageQuizScore()"
    />

    <!-- In Progress Courses -->
    @if (inProgressCourses().length > 0) {
      <div class="courses-section">
        <div class="section-header">
          <h2>Continue Learning</h2>
          <span class="count">{{ inProgressCourses().length }} course{{ inProgressCourses().length > 1 ? 's' : '' }}</span>
        </div>
        <div class="courses-grid">
          @for (course of inProgressCourses(); track course.course.id) {
            <app-dashboard-course-card
              [data]="course"
              (actionClick)="handleCourseAction($event)"
              (courseClick)="viewCourseDetails($event)"
            />
          }
        </div>
      </div>
    }

    <!-- Not Started Courses -->
    @if (notStartedCourses().length > 0) {
      <div class="courses-section">
        <div class="section-header">
          <h2>Start Learning</h2>
          <span class="count">{{ notStartedCourses().length }} course{{ notStartedCourses().length > 1 ? 's' : '' }}</span>
        </div>
        <div class="courses-grid">
          @for (course of notStartedCourses(); track course.course.id) {
            <app-dashboard-course-card
              [data]="course"
              (actionClick)="handleCourseAction($event)"
              (courseClick)="viewCourseDetails($event)"
            />
          }
        </div>
      </div>
    }

    <!-- Completed Courses -->
    @if (completedCourses().length > 0) {
      <div class="courses-section">
        <div class="section-header">
          <h2>Completed</h2>
          <span class="count">{{ completedCourses().length }} course{{ completedCourses().length > 1 ? 's' : '' }}</span>
        </div>
        <div class="courses-grid">
          @for (course of completedCourses(); track course.course.id) {
            <app-dashboard-course-card
              [data]="course"
              (actionClick)="handleCourseAction($event)"
              (courseClick)="viewCourseDetails($event)"
            />
          }
        </div>
      </div>
    }

    <!-- Empty State -->
    @if (userCourses().length === 0) {
      <div class="empty-state">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
          <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
        </svg>
        <h3>No courses found</h3>
        <p>Looks like you haven't enrolled in any courses yet.</p>
        <button class="btn-primary" (click)="router.navigate(['/courses'])">
          Browse Courses
        </button>
      </div>
    }
  }
</div>
