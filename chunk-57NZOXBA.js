import{a as I}from"./chunk-CKQXZY5F.js";import{c as d,fa as u,ja as m,k as h,n as g,w as c}from"./chunk-PYF3QQPI.js";var C=class a{http=g(m);storageService=g(I);COURSES_CONFIG_URL="/assets/config/courses.config.json";COURSES_CACHE_KEY="onboardsMe_courses_cache";courses=c([]);loading=c(!1);error=c(null);enrolledCourseIds=u(()=>this.storageService.enrollmentData()?.enrolledCourses||[]);enrolledCourses=u(()=>{let e=this.enrolledCourseIds();return this.courses().filter(s=>e.includes(s.id))});availableCourses=u(()=>{let e=this.enrolledCourseIds();return this.courses().filter(s=>!e.includes(s.id))});coursesForUserRole=u(()=>{let e=this.storageService.enrollmentData();return e?this.courses().filter(s=>s.roles.includes(e.role)):[]});constructor(){this.loadCourses()}loadCourses(){return d(this,null,function*(){this.loading.set(!0),this.error.set(null);try{let e=this.getCachedCourses();if(e&&e.length>0){this.courses.set(e),this.loading.set(!1),this.refreshCoursesFromServer();return}yield this.refreshCoursesFromServer()}catch(e){console.error("Failed to load courses:",e),this.error.set("Failed to load courses. Please try again."),this.loading.set(!1)}})}refreshCoursesFromServer(){return d(this,null,function*(){try{let s=yield(yield fetch(this.COURSES_CONFIG_URL)).json();this.courses.set(s.courses),this.cacheCourses(s.courses)}catch(e){console.error("Failed to refresh courses:",e),this.courses().length===0&&this.error.set("Failed to load courses from server.")}finally{this.loading.set(!1)}})}getAllCourses(){return this.courses()}getCourseById(e){return this.courses().find(s=>s.id===e)}getLessonById(e,s){return this.getCourseById(e)?.lessons.find(n=>n.id===s)}getLearningItemById(e,s,t){return this.getLessonById(e,s)?.learningItems.find(o=>o.id===t)}isEnrolledInCourse(e){return this.enrolledCourseIds().includes(e)}enrollInCourse(e){let s=this.enrolledCourseIds();s.includes(e)||this.storageService.updateEnrolledCourses([...s,e])}unenrollFromCourse(e){let s=this.enrolledCourseIds();this.storageService.updateEnrolledCourses(s.filter(t=>t!==e))}getTotalItemsInCourse(e){let s=this.getCourseById(e);return s?s.lessons.reduce((t,n)=>t+n.learningItems.length,0):0}getTotalLessonsInCourse(e){return this.getCourseById(e)?.lessons.length||0}getNextLearningItem(e,s,t){let n=this.getCourseById(e);if(!n)return null;let o=n.lessons.findIndex(r=>r.id===s);if(o===-1)return null;let i=n.lessons[o],l=i.learningItems.findIndex(r=>r.id===t);if(l<i.learningItems.length-1)return{lesson:i,item:i.learningItems[l+1]};if(o<n.lessons.length-1){let r=n.lessons[o+1];if(r.learningItems.length>0)return{lesson:r,item:r.learningItems[0]}}return null}getPreviousLearningItem(e,s,t){let n=this.getCourseById(e);if(!n)return null;let o=n.lessons.findIndex(r=>r.id===s);if(o===-1)return null;let i=n.lessons[o],l=i.learningItems.findIndex(r=>r.id===t);if(l>0)return{lesson:i,item:i.learningItems[l-1]};if(o>0){let r=n.lessons[o-1];if(r.learningItems.length>0)return{lesson:r,item:r.learningItems[r.learningItems.length-1]}}return null}getFirstLearningItem(e){let s=this.getCourseById(e);if(!s||s.lessons.length===0)return null;let t=s.lessons[0];return t.learningItems.length===0?null:{lesson:t,item:t.learningItems[0]}}getCachedCourses(){try{let e=localStorage.getItem(this.COURSES_CACHE_KEY);return e?JSON.parse(e):null}catch{return null}}cacheCourses(e){try{localStorage.setItem(this.COURSES_CACHE_KEY,JSON.stringify(e))}catch(s){console.warn("Failed to cache courses:",s)}}static \u0275fac=function(s){return new(s||a)};static \u0275prov=h({token:a,factory:a.\u0275fac,providedIn:"root"})};export{C as a};
