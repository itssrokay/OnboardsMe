import{b as V,d as A,e as F,f as D,k as $,l as j}from"./chunk-44NXRQMQ.js";import{a as N}from"./chunk-CT67W7SA.js";import{a as L}from"./chunk-5WTPKT27.js";import{a as E}from"./chunk-57NZOXBA.js";import"./chunk-CKQXZY5F.js";import{$ as z,A as c,D as Q,H as C,K as w,L as S,M as v,O as f,P as y,R as P,S as M,T as o,U as r,V as O,W as p,X as m,Y as l,Z as s,_ as g,aa as q,fa as x,ha as k,n as b,oa as I,p as d,q as u,qa as T,w as _}from"./chunk-PYF3QQPI.js";var G=(a,e)=>e.id;function B(a,e){a&1&&(o(0,"div",1),O(1,"div",3),o(2,"p"),s(3,"Loading quiz..."),r()())}function Y(a,e){if(a&1){let t=p();o(0,"div",2)(1,"div",4),s(2,"\u26A0\uFE0F"),r(),o(3,"h2"),s(4,"Cannot Access Quiz"),r(),o(5,"p"),s(6),r(),o(7,"button",5),m("click",function(){d(t);let n=l();return u(n.router.navigate(["/courses",n.courseId()]))}),s(8," Back to Course "),r()()}if(a&2){let t=l();c(6),g(t.error())}}function U(a,e){if(a&1&&(o(0,"div",11)(1,"span",12),s(2,"Time:"),r(),o(3,"span",13),s(4),r()()),a&2){let t=l(),i=l(2);v("time-warning",i.timeRemaining()&&i.timeRemaining()<300),c(4),q("",i.formatTime(i.elapsedTime())," / ",t.timeLimit," min")}}function H(a,e){if(a&1){let t=p();o(0,"div",37),m("click",function(){let n=d(t).$index,h=l(5);return u(h.selectAnswer(h.currentQuestionIndex(),n))}),o(1,"div",38)(2,"span",39),s(3),r()(),o(4,"span",40),s(5),r()()}if(a&2){let t=e.$implicit,i=e.$index,n=l(5);v("selected",n.isAnswerSelected(n.currentQuestionIndex(),i)),c(3),g(n.getOptionLetter(i)),c(2),g(t)}}function J(a,e){if(a&1&&(o(0,"div",28),P(1,H,6,4,"div",36,y),r()),a&2){let t=l();c(),M(t.options)}}function K(a,e){if(a&1){let t=p();o(0,"div",29)(1,"div",41),m("click",function(){d(t);let n=l(4);return u(n.selectAnswer(n.currentQuestionIndex(),"true"))}),o(2,"div",42),s(3,"\u2713"),r(),o(4,"span"),s(5,"True"),r()(),o(6,"div",41),m("click",function(){d(t);let n=l(4);return u(n.selectAnswer(n.currentQuestionIndex(),"false"))}),o(7,"div",42),s(8,"\u2717"),r(),o(9,"span"),s(10,"False"),r()()()}if(a&2){let t=l(4);c(),v("selected",t.isAnswerSelected(t.currentQuestionIndex(),"true")),c(5),v("selected",t.isAnswerSelected(t.currentQuestionIndex(),"false"))}}function W(a,e){if(a&1){let t=p();o(0,"button",43),m("click",function(){let n=d(t).$index,h=l(4);return u(h.goToQuestion(n))}),s(1),r()}if(a&2){let t=e.$index,i=l(4);v("active",t===i.currentQuestionIndex())("answered",i.isQuestionAnswered(t)),w("title","Question "+(t+1)),c(),z(" ",t+1," ")}}function X(a,e){if(a&1){let t=p();o(0,"button",44),m("click",function(){d(t);let n=l(4);return u(n.nextQuestion())}),s(1," Next \u2192 "),r()}}function Z(a,e){if(a&1){let t=p();o(0,"button",45),m("click",function(){d(t);let n=l(4);return u(n.requestSubmit())}),s(1," Submit Quiz "),r()}if(a&2){let t=l(4);w("disabled",!t.canSubmit())}}function tt(a,e){if(a&1){let t=p();o(0,"form",19)(1,"div",22)(2,"div",23)(3,"span",24),s(4),r(),o(5,"span",25),s(6),r()(),o(7,"h2",26),s(8),r(),o(9,"div",27),C(10,J,3,0,"div",28)(11,K,11,4,"div",29),r()(),o(12,"div",30)(13,"button",31),m("click",function(){d(t);let n=l(3);return u(n.previousQuestion())}),s(14," \u2190 Previous "),r(),o(15,"div",32),P(16,W,2,6,"button",33,G),r(),C(18,X,2,0,"button",34)(19,Z,2,1,"button",35),r()()}if(a&2){let t=e,i=l(),n=l(2);w("formGroup",n.quizForm),c(4),z("Question ",n.getQuestionNumber(n.currentQuestionIndex()),""),c(2),z("",t.points," points"),c(2),g(t.question),c(2),f(t.type==="single-choice"?10:t.type==="true-false"?11:-1),c(3),w("disabled",n.isFirstQuestion()),c(3),M(i.questions),c(2),f(n.isLastQuestion()?19:18)}}function et(a,e){if(a&1){let t=p();o(0,"div",46),m("click",function(){d(t);let n=l(3);return u(n.cancelSubmit())}),o(1,"div",47),m("click",function(n){return d(t),u(n.stopPropagation())}),o(2,"h3"),s(3,"Submit Quiz?"),r(),o(4,"p"),s(5," You have answered "),o(6,"strong"),s(7),r(),s(8," out of "),o(9,"strong"),s(10),r(),s(11," questions. "),r(),o(12,"p"),s(13,"Are you sure you want to submit your quiz?"),r(),o(14,"div",48)(15,"button",49),m("click",function(){d(t);let n=l(3);return u(n.cancelSubmit())}),s(16," Cancel "),r(),o(17,"button",50),m("click",function(){d(t);let n=l(3);return u(n.confirmSubmit())}),s(18," Submit "),r()()()()}if(a&2){let t=l(3);c(7),g(t.getAnsweredCount()),c(3),g(t.totalQuestions())}}function nt(a,e){if(a&1){let t=p();o(0,"div",6)(1,"div",7)(2,"div",8)(3,"h1"),s(4),r(),o(5,"p",9),s(6),r()(),o(7,"div",10)(8,"div",11)(9,"span",12),s(10,"Questions:"),r(),o(11,"span",13),s(12),r()(),o(13,"div",11)(14,"span",12),s(15,"Passing Score:"),r(),o(16,"span",13),s(17),r()(),C(18,U,5,4,"div",14),r()(),o(19,"div",15)(20,"div",16)(21,"span"),s(22),r(),o(23,"span"),s(24),r()(),o(25,"div",17),O(26,"div",18),r()(),C(27,tt,20,7,"form",19),o(28,"button",20),m("click",function(){d(t);let n=l(2);return u(n.exitQuiz())}),s(29," Exit Quiz "),r(),C(30,et,19,2,"div",21),r()}if(a&2){let t,i=e,n=l(2);c(4),g(i.title),c(2),g(i.description),c(6),g(n.totalQuestions()),c(5),z("",i.passingScore,"%"),c(),f(i.timeLimit?18:-1),c(4),q("Question ",n.currentQuestionIndex()+1," of ",n.totalQuestions(),""),c(2),z("",n.getAnsweredCount()," answered"),c(2),S("width",n.progress(),"%"),c(),f((t=n.currentQuestion())?27:-1,t),c(3),f(n.showConfirmDialog()?30:-1)}}function it(a,e){if(a&1&&C(0,nt,31,12,"div",6),a&2){let t,i=l();f((t=i.quiz())?0:-1,t)}}var R=class a{route=b(I);router=b(T);fb=b($);quizService=b(N);courseService=b(E);progressService=b(L);courseId=_("");quiz=_(null);currentAttempt=_(null);quizForm;loading=_(!0);error=_(null);submitting=_(!1);startTime=_(0);elapsedTime=_(0);timerInterval;showConfirmDialog=_(!1);currentQuestionIndex=_(0);timeRemaining=x(()=>{let e=this.quiz();if(!e?.timeLimit)return null;let i=e.timeLimit*60-this.elapsedTime();return i>0?i:0});isTimeUp=x(()=>{let e=this.timeRemaining();return e!==null&&e<=0});currentQuestion=x(()=>{let e=this.quiz(),t=this.currentQuestionIndex();return e?.questions[t]||null});totalQuestions=x(()=>this.quiz()?.questions.length||0);isLastQuestion=x(()=>this.currentQuestionIndex()>=this.totalQuestions()-1);isFirstQuestion=x(()=>this.currentQuestionIndex()===0);progress=x(()=>{let e=this.totalQuestions();return e===0?0:Math.round((this.currentQuestionIndex()+1)/e*100)});ngOnInit(){this.route.paramMap.subscribe(e=>{let t=e.get("courseId");t&&(this.courseId.set(t),this.loadQuiz(t))})}ngOnDestroy(){this.stopTimer()}loadQuiz(e){if(this.loading.set(!0),this.error.set(null),this.progressService.getCourseCompletionPercentage(e)<100){this.error.set("You must complete all learning materials before taking the quiz."),this.loading.set(!1);return}let i=()=>{let n=this.quizService.getQuizByCourseId(e);n?(this.quiz.set(n),this.initializeForm(n),this.startQuiz(n),this.loading.set(!1)):this.quizService.loading()?setTimeout(i,100):(this.error.set("Quiz not found for this course."),this.loading.set(!1))};i()}initializeForm(e){let t=this.fb.array(e.questions.map(i=>this.fb.control("",V.required)));this.quizForm=this.fb.group({questions:t})}get questionsFormArray(){return this.quizForm?.get("questions")}startQuiz(e){let t=this.quizService.startQuizAttempt(e.id,this.courseId());this.currentAttempt.set(t),this.startTime.set(Date.now()),this.startTimer()}startTimer(){this.timerInterval=setInterval(()=>{let e=Math.floor((Date.now()-this.startTime())/1e3);this.elapsedTime.set(e),this.isTimeUp()&&this.autoSubmit()},1e3)}stopTimer(){this.timerInterval&&clearInterval(this.timerInterval)}selectAnswer(e,t){this.questionsFormArray.at(e).setValue(t)}isAnswerSelected(e,t){return this.questionsFormArray.at(e).value===t}nextQuestion(){this.isLastQuestion()||this.currentQuestionIndex.update(e=>e+1)}previousQuestion(){this.isFirstQuestion()||this.currentQuestionIndex.update(e=>e-1)}goToQuestion(e){this.currentQuestionIndex.set(e)}isQuestionAnswered(e){let t=this.questionsFormArray.at(e);return t&&t.value!==""}getAnsweredCount(){return this.questionsFormArray.controls.filter(e=>e.value!=="").length}canSubmit(){return this.quizForm.valid&&!this.submitting()}requestSubmit(){this.canSubmit()&&this.showConfirmDialog.set(!0)}cancelSubmit(){this.showConfirmDialog.set(!1)}confirmSubmit(){this.showConfirmDialog.set(!1),this.submitQuiz()}autoSubmit(){this.stopTimer(),this.submitQuiz()}submitQuiz(){if(!this.quiz()||!this.currentAttempt())return;this.submitting.set(!0),this.stopTimer();let e=this.quiz(),t={};e.questions.forEach((i,n)=>{let h=this.questionsFormArray.at(n).value;t[i.id]=h});try{let i=this.quizService.submitQuizAttempt(this.currentAttempt(),t);this.router.navigate(["/courses",this.courseId(),"quiz","result"],{state:{result:i}})}catch(i){console.error("Failed to submit quiz:",i),this.error.set("Failed to submit quiz. Please try again."),this.submitting.set(!1)}}exitQuiz(){confirm("Are you sure you want to exit? Your progress will be lost.")&&(this.stopTimer(),this.router.navigate(["/courses",this.courseId()]))}formatTime(e){let t=Math.floor(e/60),i=e%60;return`${t.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}getQuestionNumber(e){return e+1}getOptionLetter(e){return String.fromCharCode(65+e)}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=Q({type:a,selectors:[["app-quiz"]],decls:4,vars:1,consts:[[1,"quiz-container"],[1,"loading-state"],[1,"error-state"],[1,"spinner"],[1,"error-icon"],[1,"btn","btn-primary",3,"click"],[1,"quiz-wrapper"],[1,"quiz-header"],[1,"header-content"],[1,"description"],[1,"quiz-meta"],[1,"meta-item"],[1,"label"],[1,"value"],[1,"meta-item",3,"time-warning"],[1,"progress-section"],[1,"progress-info"],[1,"progress-bar"],[1,"progress-fill"],[1,"quiz-form",3,"formGroup"],[1,"exit-btn",3,"click"],[1,"modal-overlay"],[1,"question-card"],[1,"question-header"],[1,"question-number"],[1,"question-points"],[1,"question-text"],[1,"answers-section"],[1,"answer-options"],[1,"true-false-options"],[1,"navigation-section"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],[1,"nav-dots"],["type","button",1,"nav-dot",3,"active","answered","title"],["type","button",1,"btn","btn-primary"],["type","button",1,"btn","btn-success",3,"disabled"],[1,"answer-option",3,"selected"],[1,"answer-option",3,"click"],[1,"option-indicator"],[1,"option-letter"],[1,"option-text"],[1,"tf-option",3,"click"],[1,"tf-icon"],["type","button",1,"nav-dot",3,"click","title"],["type","button",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-success",3,"click","disabled"],[1,"modal-overlay",3,"click"],[1,"modal-dialog",3,"click"],[1,"modal-actions"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-success",3,"click"]],template:function(t,i){t&1&&(o(0,"div",0),C(1,B,4,0,"div",1)(2,Y,9,1,"div",2)(3,it,1,1),r()),t&2&&(c(),f(i.loading()?1:i.error()?2:3))},dependencies:[k,j,F,A,D],styles:[".quiz-container[_ngcontent-%COMP%]{min-height:100vh;background:#f7fafc;padding:2rem}.loading-state[_ngcontent-%COMP%], .error-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:60vh;text-align:center}.spinner[_ngcontent-%COMP%]{width:48px;height:48px;border:4px solid #e2e8f0;border-top-color:#667eea;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem}.quiz-wrapper[_ngcontent-%COMP%]{max-width:900px;margin:0 auto;position:relative}.quiz-header[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:12px;margin-bottom:1.5rem;box-shadow:0 2px 4px #0000001a}.quiz-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;color:#1a202c;font-size:2rem}.quiz-header[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{color:#718096;margin:0 0 1.5rem}.quiz-header[_ngcontent-%COMP%]   .quiz-meta[_ngcontent-%COMP%]{display:flex;gap:2rem;flex-wrap:wrap}.quiz-header[_ngcontent-%COMP%]   .quiz-meta[_ngcontent-%COMP%]   .meta-item[_ngcontent-%COMP%]{display:flex;gap:.5rem}.quiz-header[_ngcontent-%COMP%]   .quiz-meta[_ngcontent-%COMP%]   .meta-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:#718096;font-weight:500}.quiz-header[_ngcontent-%COMP%]   .quiz-meta[_ngcontent-%COMP%]   .meta-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#1a202c;font-weight:600}.quiz-header[_ngcontent-%COMP%]   .quiz-meta[_ngcontent-%COMP%]   .meta-item.time-warning[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:#e53e3e}.progress-section[_ngcontent-%COMP%]{background:#fff;padding:1.5rem;border-radius:12px;margin-bottom:1.5rem;box-shadow:0 2px 4px #0000001a}.progress-section[_ngcontent-%COMP%]   .progress-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:.75rem;font-size:.875rem;color:#718096;font-weight:500}.progress-section[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]{height:8px;background:#e2e8f0;border-radius:4px;overflow:hidden}.progress-section[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]   .progress-fill[_ngcontent-%COMP%]{height:100%;background:linear-gradient(90deg,#667eea,#764ba2);transition:width .3s ease}.question-card[_ngcontent-%COMP%]{background:#fff;padding:2.5rem;border-radius:12px;margin-bottom:1.5rem;box-shadow:0 2px 4px #0000001a}.question-card[_ngcontent-%COMP%]   .question-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.question-card[_ngcontent-%COMP%]   .question-header[_ngcontent-%COMP%]   .question-number[_ngcontent-%COMP%]{color:#667eea;font-weight:600;font-size:.875rem;text-transform:uppercase}.question-card[_ngcontent-%COMP%]   .question-header[_ngcontent-%COMP%]   .question-points[_ngcontent-%COMP%]{background:#edf2f7;padding:.25rem .75rem;border-radius:12px;font-size:.875rem;font-weight:600;color:#4a5568}.question-card[_ngcontent-%COMP%]   .question-text[_ngcontent-%COMP%]{font-size:1.5rem;color:#1a202c;margin:0 0 2rem;line-height:1.5}.answers-section[_ngcontent-%COMP%]{margin-top:2rem}.answer-options[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.answer-option[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1.25rem;background:#f7fafc;border:2px solid #e2e8f0;border-radius:12px;cursor:pointer;transition:all .2s}.answer-option[_ngcontent-%COMP%]:hover{border-color:#667eea;background:#edf2f7}.answer-option.selected[_ngcontent-%COMP%]{border-color:#667eea;background:#e6eeff}.answer-option.selected[_ngcontent-%COMP%]   .option-indicator[_ngcontent-%COMP%]{background:#667eea;color:#fff}.answer-option[_ngcontent-%COMP%]   .option-indicator[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background:#fff;border:2px solid #e2e8f0;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-weight:600;color:#4a5568;transition:all .2s}.answer-option[_ngcontent-%COMP%]   .option-text[_ngcontent-%COMP%]{flex:1;font-size:1rem;color:#2d3748;line-height:1.5}.true-false-options[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}.tf-option[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem;padding:2rem;background:#f7fafc;border:3px solid #e2e8f0;border-radius:12px;cursor:pointer;transition:all .2s}.tf-option[_ngcontent-%COMP%]:hover{border-color:#667eea;transform:translateY(-2px)}.tf-option.selected[_ngcontent-%COMP%]{border-color:#667eea;background:#e6eeff}.tf-option.selected[_ngcontent-%COMP%]   .tf-icon[_ngcontent-%COMP%]{background:#667eea;color:#fff}.tf-option[_ngcontent-%COMP%]   .tf-icon[_ngcontent-%COMP%]{width:64px;height:64px;border-radius:50%;background:#fff;border:2px solid #e2e8f0;display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:700;transition:all .2s}.tf-option[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:600;color:#2d3748}.navigation-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:1rem;padding:1.5rem;background:#fff;border-radius:12px;box-shadow:0 2px 4px #0000001a}.nav-dots[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap;justify-content:center;flex:1}.nav-dot[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;border:2px solid #e2e8f0;background:#fff;color:#718096;font-size:.875rem;font-weight:600;cursor:pointer;transition:all .2s}.nav-dot[_ngcontent-%COMP%]:hover{border-color:#667eea}.nav-dot.active[_ngcontent-%COMP%]{border-color:#667eea;background:#667eea;color:#fff}.nav-dot.answered[_ngcontent-%COMP%]:not(.active){background:#c6f6d5;border-color:#48bb78;color:#22543d}.btn[_ngcontent-%COMP%]{padding:.75rem 1.5rem;border-radius:8px;font-weight:600;font-size:1rem;cursor:pointer;transition:all .2s;border:none}.btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.btn.btn-primary[_ngcontent-%COMP%]{background:#667eea;color:#fff}.btn.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){background:#5a67d8}.btn.btn-secondary[_ngcontent-%COMP%]{background:#edf2f7;color:#4a5568}.btn.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background:#e2e8f0}.btn.btn-success[_ngcontent-%COMP%]{background:#48bb78;color:#fff}.btn.btn-success[_ngcontent-%COMP%]:hover:not(:disabled){background:#38a169}.exit-btn[_ngcontent-%COMP%]{position:fixed;top:2rem;right:2rem;padding:.75rem 1.5rem;background:#fff;border:2px solid #e2e8f0;border-radius:8px;color:#4a5568;font-weight:600;cursor:pointer;transition:all .2s;z-index:100}.exit-btn[_ngcontent-%COMP%]:hover{border-color:#e53e3e;color:#e53e3e}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:1000}.modal-dialog[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:12px;max-width:500px;width:90%;box-shadow:0 20px 60px #0000004d}.modal-dialog[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem;color:#1a202c}.modal-dialog[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#4a5568;margin:0 0 1rem;line-height:1.6}.modal-dialog[_ngcontent-%COMP%]   .modal-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;justify-content:flex-end;margin-top:1.5rem}@media (max-width: 768px){.quiz-container[_ngcontent-%COMP%]{padding:1rem}.quiz-header[_ngcontent-%COMP%]{padding:1.5rem}.quiz-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}.quiz-header[_ngcontent-%COMP%]   .quiz-meta[_ngcontent-%COMP%]{flex-direction:column;gap:.75rem}.question-card[_ngcontent-%COMP%]{padding:1.5rem}.question-card[_ngcontent-%COMP%]   .question-text[_ngcontent-%COMP%]{font-size:1.25rem}.true-false-options[_ngcontent-%COMP%]{grid-template-columns:1fr}.navigation-section[_ngcontent-%COMP%]{flex-wrap:wrap}.nav-dots[_ngcontent-%COMP%]{order:3;width:100%;margin-top:1rem}.exit-btn[_ngcontent-%COMP%]{top:1rem;right:1rem;padding:.5rem 1rem;font-size:.875rem}}"]})};export{R as QuizComponent};
